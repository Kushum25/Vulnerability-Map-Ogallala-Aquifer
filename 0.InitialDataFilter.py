# -*- coding: utf-8 -*-
"""
Created on Sun Mar  5 18:48:21 2023

@author: Kushum
"""

import os
import pandas as pd
import numpy as np

#Setting working directory
path ='D:\\OneDrive - Lamar University\\00Spring2023\\MachineLearning\\Project_2\\Wd\\data'
os.chdir(path)

#Step 1: Read the txt file and convert it into a csv file for (well mains and Water Quality major)
df1 = pd.read_csv('WellMain.txt', sep= '|', encoding= 'unicode_escape')

df2 = pd.read_csv('WaterQualityMajor.txt', sep= '|', encoding= 'unicode_escape', on_bad_lines='skip')

#Step 3: Filtering the data
#Step 3.1: Filtering the Water Quality data for Ogallala aquifer
a = df2[(df2['Aquifer'] == 'Ogallala')]

#Step 3.2: Selecting the pollutant for the modeling
from collections import Counter
ParamD = dict(Counter(a['ParameterDescription']))
print (ParamD)
Para_list = pd.DataFrame.from_dict(ParamD.items())

#Selecting the 'Fluoride' mg/L as the pollutant for modelling
b = a[a['ParameterCode'] == 950]

#Step 3.3: Getting all the data from 2000 to 2023 for the wells in ogallala aquifer
c = b[b['SampleYear'] >= 2000]

#Step 3.5: Average the fluoride data for same well (unique well)
Avg_Flo = c.groupby('StateWellNumber').mean()

#creating the datafrae having state well id and average fluoride
wellid = list(Avg_Flo.index.values)
Avg_Fl = list(Avg_Flo.ParameterValue)

data = {'StateWellNumber': wellid, 'Average_Fluoride': Avg_Fl}
df_Fl = pd.DataFrame(data)

#Step 3.4: Getting all the wells from ogallala aquifer 
all_ogg_wells = df1[(df1['Aquifer'] == 'Ogallala')]
Ogg_df = all_ogg_wells.iloc[:,[0,12,16,23]]

#Total count of unique wells in the ogallala aquifer left after filtering for Fluoride and time.
un_wells = np.unique(c['StateWellNumber'])

#Step 4: Joining the dataframes to get the final dataframe with required columns
Final_df = pd.merge(Ogg_df, df_Fl, on='StateWellNumber')

#no_depth = Final_df['WellDepth'].isna().sum()
dfFinal = Final_df.dropna()

#write the csv file to new working directory
#os.chdir('D:\\OneDrive - Lamar University\\00Spring2023\\MachineLearning\\Project_2\\Wd')
#pd.DataFrame.to_csv(dfFinal ,'1.Ogallala_Fluoride.csv', index=False)
