# -*- coding: utf-8 -*-
"""
Created on Tue Mar  7 19:00:08 2023

@author: 14098
"""

import geopandas as gpd
import fiona
import pandas as pd
import os


#Setting working directory
path ='C:/Users/14098/OneDrive - Lamar University/Desktop/Machine Learning/Project 2/major_aquifers'
os.chdir(path)

# file for major aquifer
fname = 'C:/Users/14098/OneDrive - Lamar University/Desktop/Machine Learning/Project 2/major_aquifers/NEW_major_aquifers_dd.shp'

#reading the shape file
Allaquifer = gpd.read_file(fname)
Allaquifer.columns
Allaquifer.AQ_NAME.unique()

#choosing ogallala aquifer to clip
Name = 'OGALLALA'
Allogallala = Allaquifer.loc[Allaquifer.AQ_NAME == Name]

#setting coordinate system and plotting ogallala boundary map
espgaea = 5070
oggaea = Allogallala.to_crs(espgaea)
oggaea.plot()
oggaea.to_file('ogallalaea.shp')


#Setting working directory
fname ='C:/Users/14098/OneDrive - Lamar University/Desktop/Machine Learning/Project 2/gSSURGO_TX/gSSURGO_TX.gdb'
layers = fiona.listlayers(fname)


#extracting the layers essential for obtaining soil texture
texture = gpd.read_file(fname,layer = 'chtexture') #reading the gpd file
texturegrp = gpd.read_file(fname,layer = 'chtexturegrp')
horizon = gpd.read_file(fname,layer = 'chorizon')
component = gpd.read_file(fname,layer = 'component')
mapunit = gpd.read_file(fname,layer = 'mapunit')
legend = gpd.read_file(fname,layer = 'legend')

#setting working directory for MU_polygon
path1 = "C:/Users/14098/OneDrive - Lamar University/Desktop/Machine Learning/Project 2/Shapefile"
os.chdir(path1)
fname1 = 'MU_POLYGON.shp'
soilpoly = gpd.read_file(fname1)

#soilpoly.crs

#Plot the soil polygon
plotx = soilpoly.plot()
plotx.set_xlabel('Easting')
plotx.set_ylabel('Northing')

#performing joins to get soil texture with the map minding its primary key and foreign key
texturegrp1 = pd.merge(texturegrp,texture[['texcl','chtgkey']], on='chtgkey',how='left')
horizon1 = pd.merge(horizon,texturegrp1[['texcl','chkey']], on='chkey',how='left')
component1 = pd.merge(component,horizon1[['texcl','cokey']], on='cokey',how='left')
mapunit1 = pd.merge(mapunit,component1[['texcl','mukey']], on='mukey',how='left')

#assigning mukey to soilpoly
mukey = soilpoly['MUKEY']
soilpoly = soilpoly.assign(mukey=mukey)

#extract the crs and geometry
crsx = soilpoly.crs
geomx = soilpoly.geometry


#obtaining soil texture in soil poly
soilpoly1 = pd.merge(soilpoly,mapunit1,on='mukey',how='inner')
soilpoly1.set_geometry(geomx,inplace=True,crs = crsx)
soilpoly1.plot('texcl')
#soilpoly1.to_csv('soilpoly1.csv')





